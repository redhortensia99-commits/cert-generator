<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tแบกo Chแปฉng Chแป Chuyรชn Mรดn โ SKYPEC</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="bg-blur"></div>
  <div class="app">

    <!-- Header -->
    <header class="header">
      <div class="logo">
        <span class="logo-icon">๐</span>
        <div>
          <h1>Tแบกo Chแปฉng Chแป</h1>
          <span class="logo-sub">Chuyรชn Mรดn Tแปฑ ฤแปng</span>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:12px">
        <span class="badge">SKYPEC</span>
        <a href="/logout"
          style="font-size:.8rem;color:#9ba3c4;text-decoration:none;padding:6px 12px;border:1px solid #1e2235;border-radius:8px;transition:all .2s"
          onmouseover="this.style.color='#fff'" onmouseout="this.style.color='#9ba3c4'">๐ช ฤฤng xuแบฅt</a>
      </div>
    </header>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" id="tab-templates" onclick="switchTab('templates')">
        ๐ Quแบฃn Lรฝ Mแบซu
      </button>
      <button class="tab" id="tab-generate" onclick="switchTab('generate')">
        โก Tแบกo Chแปฉng Chแป
      </button>
    </div>

    <!-- ========== TAB: TEMPLATE MANAGER ========== -->
    <div id="panel-templates" class="panel">

      <!-- Upload new template -->
      <div class="card">
        <div class="card-header">
          <h2>โ Thรชm Mแบซu Chแปฉng Chแป</h2>
          <p>Upload file Word (.docx) hoแบทc แบขnh (.jpg, .png) lรm mแบซu chแปฉng chแป</p>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Tรชn mแบซu chแปฉng chแป</label>
            <input type="text" id="tpl-name" placeholder="VD: ANKS ฤแปnh kแปณ 2026" />
          </div>
          <div class="form-group">
            <label>File mแบซu</label>
            <div class="file-btn-wrapper">
              <button class="btn-outline" onclick="document.getElementById('tpl-file').click()">๐ Chแปn File</button>
              <span id="tpl-file-label" class="file-label">Chฦฐa chแปn</span>
              <input type="file" id="tpl-file" accept=".docx,.jpg,.jpeg,.png,.gif,.webp" hidden />
            </div>
          </div>
          <button class="btn-primary" onclick="uploadTemplate()">Tแบฃi Lรชn</button>
        </div>
        <div class="note">
          ๐ก <strong>Word (.docx)</strong>: dรนng placeholder <code>{ho_ten}</code>, <code>{ket_qua}</code>... cho text,
          <code>{%anh_the}</code> cho แบฃnh. &nbsp;|&nbsp;
          <strong>แบขnh (.jpg/.png)</strong>: sau khi upload, nhแบฅn <em>"Cรi ฤแบทt vแป trรญ"</em> ฤแป kรฉo thแบฃ cรกc trฦฐแปng dแปฏ liแปu
          lรชn แบฃnh.
        </div>
      </div>

      <!-- Template list -->
      <div class="card">
        <div class="card-header">
          <h2>๐ Danh Sรกch Mแบซu</h2>
          <p>Cรกc mแบซu chแปฉng chแป ฤรฃ ฤฦฐแปฃc lฦฐu</p>
        </div>
        <div id="tpl-list">
          <div class="empty-state">๐ ฤang tแบฃi...</div>
        </div>
      </div>
    </div>

    <!-- ========== TAB: GENERATE ========== -->
    <div id="panel-generate" class="panel hidden">
      <div class="card" id="gen-upload-card">
        <div class="card-header">
          <h2>โก Tแบกo Chแปฉng Chแป</h2>
          <p>Chแปn mแบซu vร upload file Excel danh sรกch hแปc viรชn</p>
        </div>

        <div class="form-group" style="margin-bottom:20px">
          <label>Mแบซu chแปฉng chแป</label>
          <select id="gen-template-select">
            <option value="">-- Chแปn mแบซu chแปฉng chแป --</option>
          </select>
        </div>

        <div class="upload-zone" id="excel-zone">
          <input type="file" id="excel-input" accept=".xlsx,.xls" hidden />
          <div class="upload-icon">๐</div>
          <h3>File Excel Danh Sรกch Hแปc Viรชn</h3>
          <p>Kรฉo thแบฃ hoแบทc click ฤแป chแปn file .xlsx</p>
          <div class="file-selected" id="excel-filename">Chฦฐa chแปn file</div>
        </div>

        <button class="btn-generate" id="btn-generate" disabled onclick="generateCertificates()">
          <span>โก</span> Tแบกo Chแปฉng Chแป
        </button>
      </div>

      <div class="card hidden" id="gen-progress-card">
        <div class="card-header">
          <h2>โ๏ธ ฤang Xแปญ Lรฝ...</h2>
          <p id="progress-msg">ฤang ฤแปc danh sรกch hแปc viรชn...</p>
        </div>
        <div class="progress-wrap">
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
          </div>
          <span id="progress-pct">0%</span>
        </div>
        <div class="loading-dots"><span></span><span></span><span></span></div>
      </div>

      <div class="card hidden" id="gen-success-card">
        <div class="success-icon">โ</div>
        <h2 style="color:var(--success)">Tแบกo Thรnh Cรดng!</h2>
        <p id="success-msg"></p>
        <div class="success-actions">
          <button class="btn-download" onclick="downloadFile()">โฌ๏ธ Tแบฃi Xuแปng Word</button>
          <button class="btn-outline" onclick="resetGenerate()">๐ Tแบกo Lแบกi</button>
        </div>
      </div>

      <div class="card hidden" id="gen-error-card">
        <div class="success-icon">โ</div>
        <h2 style="color:var(--danger)">Cรณ Lแปi Xแบฃy Ra</h2>
        <p id="error-msg" class="error-msg"></p>
        <button class="btn-outline" onclick="resetGenerate()">๐ Thแปญ Lแบกi</button>
      </div>
    </div>

    <!-- ========== MODAL: Field Placement ========== -->
    <div class="modal-overlay hidden" id="field-modal">
      <div class="modal">
        <div class="modal-header">
          <h2>๐ฏ Cรi ฤแบทt Vแป Trรญ Cรกc Trฦฐแปng</h2>
          <button class="modal-close" onclick="closeFieldModal()">โ</button>
        </div>
        <p class="modal-hint">Chแปn trฦฐแปng โ Click/kรฉo lรชn แบฃnh chแปฉng chแป ฤแป xรกc ฤแปnh vแป trรญ. Nhแบฅn <strong>Lฦฐu</strong>
          khi xong.</p>

        <div class="modal-body">
          <!-- Left: field controls -->
          <div class="field-controls">
            <div class="field-section-title">Chแปn trฦฐแปng ฤแป ฤแบทt:</div>
            <div class="field-btns" id="field-btns"></div>
            <hr style="border-color:var(--border);margin:12px 0" />
            <div class="field-section-title">ฤรฃ ฤแบทt:</div>
            <div id="placed-fields-list"></div>
            <div style="margin-top:12px">
              <label style="font-size:0.78rem;color:var(--text-muted)">Cแปก chแปฏ (pt):</label>
              <input type="number" id="field-fontsize" value="11" min="6" max="72" style="width:70px;margin-left:8px" />
              <label style="margin-left:10px"><input type="checkbox" id="field-bold" /> In ฤแบญm</label>
            </div>
          </div>

          <!-- Right: image canvas -->
          <div class="canvas-wrap">
            <div class="canvas-container" id="canvas-container">
              <img id="tpl-preview-img" src="" alt="Template preview" />
              <div id="field-markers"></div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn-outline" onclick="closeFieldModal()">Huแปท</button>
          <button class="btn-primary" onclick="saveFieldLayout()">๐พ Lฦฐu Cรi ฤแบทt</button>
        </div>
      </div>
    </div>

  </div>

  <script src="app.js"></script>
</body>

</html>